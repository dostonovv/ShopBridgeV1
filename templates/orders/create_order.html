{% extends 'base.html' %} {% block title %}Yangi buyurtma yaratish -
ShopBridge{% endblock %} {% block extra_css %} .main-container { max-width:
1000px; margin: 0 auto; padding: 32px 24px; } .page-header { text-align: center;
margin-bottom: 40px; } .page-title { font-size: 32px; font-weight: 700; color:
#265940; margin-bottom: 8px; } .page-subtitle { color: #527a66; font-size: 16px;
} .order-form-container { display: grid; grid-template-columns: 1fr 400px; gap:
32px; align-items: start; } .form-section { background: rgba(246, 244, 238,
0.95); backdrop-filter: blur(4px); border: 0.8px solid rgba(214, 209, 194, 0.5);
border-radius: 12px; padding: 24px; box-shadow: rgba(0, 0, 0, 0.1) 0px 8px 24px;
} .section-title { font-size: 20px; font-weight: 600; color: #265940;
margin-bottom: 20px; display: flex; align-items: center; gap: 8px; }
.section-icon { width: 24px; height: 24px; color: #265940; } .form-group {
margin-bottom: 20px; } .form-row { display: grid; grid-template-columns: 1fr
1fr; gap: 16px; } .form-group label { display: block; font-size: 14px;
font-weight: 500; line-height: 20px; margin-bottom: 8px; color: #1b3226; }
.form-group input, .form-group select, .form-group textarea { width: 100%;
padding: 12px; background-color: #f5f4ef; border: 0.8px solid #d6d1c2;
border-radius: 8px; font-size: 14px; line-height: 20px; transition: all 0.2s;
color: #1b3226; } .form-group input:focus, .form-group select:focus, .form-group
textarea:focus { outline: none; border-color: #265940; box-shadow: 0 0 0 3px
rgba(38, 89, 64, 0.1); } .form-group textarea { resize: vertical; min-height:
100px; } /* Product selection */ .product-selector { border: 1px solid #d6d1c2;
border-radius: 8px; padding: 16px; margin-bottom: 16px; background: #f9f8f4; }
.product-item { display: flex; align-items: center; gap: 12px; padding: 12px;
border: 1px solid #e8e5d8; border-radius: 8px; margin-bottom: 12px; background:
white; transition: all 0.2s; } .product-item:hover { border-color: #265940;
transform: translateY(-1px); } .product-item.selected { border-color: #265940;
background: rgba(38, 89, 64, 0.05); } .product-checkbox { width: 18px; height:
18px; accent-color: #265940; } .product-info { flex: 1; } .product-name {
font-weight: 600; color: #265940; margin-bottom: 4px; } .product-price { color:
#527a66; font-size: 14px; } .quantity-input { width: 80px; padding: 8px;
text-align: center; } /* Order summary */ .order-summary { background:
linear-gradient(135deg, #265940, #4a7c59); color: #f0edde; border-radius: 12px;
padding: 24px; box-shadow: rgba(0, 0, 0, 0.2) 0px 12px 32px; position: sticky;
top: 100px; } .summary-title { font-size: 20px; font-weight: 600; margin-bottom:
20px; text-align: center; } .summary-item { display: flex; justify-content:
space-between; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px
solid rgba(240, 237, 230, 0.2); } .summary-total { display: flex;
justify-content: space-between; font-size: 18px; font-weight: 700; margin-top:
16px; padding-top: 16px; border-top: 2px solid rgba(240, 237, 230, 0.3); }
.submit-btn { width: 100%; height: 48px; background-color: #f0edde; color:
#265940; border: none; border-radius: 8px; font-size: 16px; font-weight: 600;
cursor: pointer; transition: all 0.2s; margin-top: 20px; display: flex;
align-items: center; justify-content: center; gap: 8px; } .submit-btn:hover {
background-color: #f5f4ef; transform: scale(1.02); } .submit-btn:disabled {
opacity: 0.6; cursor: not-allowed; transform: none; } .loading-spinner { width:
20px; height: 20px; border: 2px solid transparent; border-top: 2px solid
currentColor; border-radius: 50%; animation: spin 1s linear infinite; display:
none; } @keyframes spin { to { transform: rotate(360deg); } } .error-message {
color: #dc2626; font-size: 12px; margin-top: 4px; display: none; }
.success-message { background-color: #d1fae5; border: 1px solid #a7f3d0; color:
#065f46; padding: 12px; border-radius: 8px; margin-bottom: 20px; display: none;
} /* Responsive design */ @media (max-width: 768px) { .navbar-container {
padding: 0 16px; } .main-container { padding: 20px 16px; } .order-form-container
{ grid-template-columns: 1fr; gap: 24px; } .form-row { grid-template-columns:
1fr; } .page-title { font-size: 28px; } .order-summary { position: static;
order: -1; } } {% endblock %} {% block content %}
<div class="main-container">
  <div class="page-header">
    <h1 class="page-title">Yangi buyurtma yaratish</h1>
    <p class="page-subtitle">
      Kerakli mahsulotlarni tanlab, buyurtma ma'lumotlarini to'ldiring
    </p>
  </div>

  <form method="post" class="order-form-container" id="orderForm">
    {% csrf_token %}

    <div>
      <!-- Product Selection -->
      <div class="form-section">
        <h3 class="section-title">
          <svg
            class="section-icon"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"
            />
          </svg>
          Mahsulotlarni tanlang
        </h3>

        <div class="product-selector">
          <div class="product-item" onclick="toggleProduct(this, 1)">
            <input
              type="checkbox"
              class="product-checkbox"
              name="products"
              value="1"
              id="product-1"
            />
            <div class="product-info">
              <div class="product-name">iPhone 15 Pro</div>
              <div class="product-price">1,200,000 so'm</div>
            </div>
            <input
              type="number"
              class="quantity-input"
              placeholder="Soni"
              min="1"
              value="1"
              name="quantity_1"
              disabled
            />
          </div>

          <div class="product-item" onclick="toggleProduct(this, 2)">
            <input
              type="checkbox"
              class="product-checkbox"
              name="products"
              value="2"
              id="product-2"
            />
            <div class="product-info">
              <div class="product-name">Samsung Galaxy S24</div>
              <div class="product-price">950,000 so'm</div>
            </div>
            <input
              type="number"
              class="quantity-input"
              placeholder="Soni"
              min="1"
              value="1"
              name="quantity_2"
              disabled
            />
          </div>

          <div class="product-item" onclick="toggleProduct(this, 3)">
            <input
              type="checkbox"
              class="product-checkbox"
              name="products"
              value="3"
              id="product-3"
            />
            <div class="product-info">
              <div class="product-name">MacBook Air M3</div>
              <div class="product-price">1,800,000 so'm</div>
            </div>
            <input
              type="number"
              class="quantity-input"
              placeholder="Soni"
              min="1"
              value="1"
              name="quantity_3"
              disabled
            />
          </div>
        </div>
      </div>

      <!-- Customer Information -->
      <div class="form-section">
        <h3 class="section-title">
          <svg
            class="section-icon"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
            />
          </svg>
          Mijoz ma'lumotlari
        </h3>

        <div class="form-row">
          <div class="form-group">
            <label for="customerName">To'liq ism</label>
            <input
              type="text"
              id="customerName"
              name="customer_name"
              placeholder="Ismingizni kiriting"
              required
            />
            <div class="error-message" id="customerNameError"></div>
          </div>

          <div class="form-group">
            <label for="customerPhone">Telefon raqam</label>
            <input
              type="tel"
              id="customerPhone"
              name="customer_phone"
              placeholder="+998 90 123 45 67"
              required
            />
            <div class="error-message" id="customerPhoneError"></div>
          </div>
        </div>

        <div class="form-group">
          <label for="customerEmail">Email manzil</label>
          <input
            type="email"
            id="customerEmail"
            name="customer_email"
            placeholder="email@misol.com"
            required
          />
          <div class="error-message" id="customerEmailError"></div>
        </div>
      </div>

      <!-- Delivery Information -->
      <div class="form-section">
        <h3 class="section-title">
          <svg
            class="section-icon"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
            />
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
            />
          </svg>
          Yetkazib berish ma'lumotlari
        </h3>

        <div class="form-group">
          <label for="deliveryAddress">Yetkazib berish manzili</label>
          <textarea
            id="deliveryAddress"
            name="delivery_address"
            placeholder="To'liq manzilni yozing"
            required
          ></textarea>
          <div class="error-message" id="deliveryAddressError"></div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="deliveryDate">Yetkazib berish sanasi</label>
            <input
              type="date"
              id="deliveryDate"
              name="delivery_date"
              required
            />
            <div class="error-message" id="deliveryDateError"></div>
          </div>

          <div class="form-group">
            <label for="deliveryTime">Yetkazib berish vaqti</label>
            <select id="deliveryTime" name="delivery_time" required>
              <option value="">Vaqtni tanlang</option>
              <option value="morning">Ertalab (9:00-12:00)</option>
              <option value="afternoon">Tushdan keyin (12:00-18:00)</option>
              <option value="evening">Kechqurun (18:00-21:00)</option>
            </select>
            <div class="error-message" id="deliveryTimeError"></div>
          </div>
        </div>

        <div class="form-group">
          <label for="specialInstructions">Qo'shimcha eslatmalar</label>
          <textarea
            id="specialInstructions"
            name="special_instructions"
            placeholder="Maxsus talablar yoki eslatmalar"
          ></textarea>
        </div>
      </div>
    </div>

    <!-- Order Summary -->
    <div class="order-summary">
      <h3 class="summary-title">Buyurtma xulosasi</h3>

      <div id="selectedProducts">
        <p style="text-align: center; color: #e2dece; font-style: italic">
          Mahsulot tanlanmagan
        </p>
      </div>

      <div class="summary-total">
        <span>Jami summa:</span>
        <span id="totalAmount">0 so'm</span>
      </div>

      <button type="submit" class="submit-btn" id="submitBtn">
        <span class="loading-spinner" id="loadingSpinner"></span>
        <span id="btnText">Buyurtma berish</span>
      </button>
    </div>
  </form>

  <div class="success-message" id="successMessage">
    Buyurtma muvaffaqiyatli yaratildi!
  </div>
</div>

<script>
  const products = {
    1: { name: "iPhone 15 Pro", price: 1200000 },
    2: { name: "Samsung Galaxy S24", price: 950000 },
    3: { name: "MacBook Air M3", price: 1800000 },
  };

  let selectedProducts = {};

  function toggleProduct(element, productId) {
    const checkbox = element.querySelector('input[type="checkbox"]');
    const quantityInput = element.querySelector(".quantity-input");

    checkbox.checked = !checkbox.checked;

    if (checkbox.checked) {
      element.classList.add("selected");
      quantityInput.disabled = false;
      selectedProducts[productId] = {
        ...products[productId],
        quantity: parseInt(quantityInput.value) || 1,
      };
    } else {
      element.classList.remove("selected");
      quantityInput.disabled = true;
      delete selectedProducts[productId];
    }

    updateOrderSummary();
  }

  function updateOrderSummary() {
    const container = document.getElementById("selectedProducts");
    const totalElement = document.getElementById("totalAmount");

    if (Object.keys(selectedProducts).length === 0) {
      container.innerHTML =
        '<p style="text-align: center; color: #e2dece; font-style: italic">Mahsulot tanlanmagan</p>';
      totalElement.textContent = "0 so'm";
      return;
    }

    let html = "";
    let total = 0;

    for (const [id, product] of Object.entries(selectedProducts)) {
      const subtotal = product.price * product.quantity;
      total += subtotal;

      html += `
            <div class="summary-item">
              <div>
                <div style="font-weight: 600">${product.name}</div>
                <div style="font-size: 12px; opacity: 0.8">${product.quantity} x ${product.price.toLocaleString()} so'm</div>
              </div>
              <div style="font-weight: 600">${subtotal.toLocaleString()} so'm</div>
            </div>
          `;
    }

    container.innerHTML = html;
    totalElement.textContent = total.toLocaleString() + " so'm";
  }

  // Quantity change listeners
  document.querySelectorAll(".quantity-input").forEach((input) => {
    input.addEventListener("change", function () {
      const productId = this.name.split("_")[1];
      if (selectedProducts[productId]) {
        selectedProducts[productId].quantity = parseInt(this.value) || 1;
        updateOrderSummary();
      }
    });
  });

  // Form validation
  document.getElementById("orderForm").addEventListener("submit", function (e) {
    if (Object.keys(selectedProducts).length === 0) {
      e.preventDefault();
      alert("Kamida bitta mahsulot tanlang!");
      return;
    }

    // Show loading state
    const submitBtn = document.getElementById("submitBtn");
    const spinner = document.getElementById("loadingSpinner");
    const btnText = document.getElementById("btnText");

    submitBtn.disabled = true;
    spinner.style.display = "inline-block";
    btnText.textContent = "Yuborilmoqda...";
  });

  // Set minimum date to today
  document.getElementById("deliveryDate").min = new Date()
    .toISOString()
    .split("T")[0];

  // Phone number formatting
  const phoneInput = document.getElementById("customerPhone");
  phoneInput.addEventListener("input", function (e) {
    let value = e.target.value.replace(/\D/g, "");

    if (value.length >= 3) {
      if (value.startsWith("998")) {
        value = value.substring(3);
      }
      if (value.length > 0) {
        let formatted = "+998";
        if (value.length > 0) formatted += " " + value.substring(0, 2);
        if (value.length > 2) formatted += " " + value.substring(2, 5);
        if (value.length > 5) formatted += " " + value.substring(5, 7);
        if (value.length > 7) formatted += " " + value.substring(7, 9);
        e.target.value = formatted;
      }
    }
  });
</script>
{% endblock %} {% block extra_js %} {% endblock %}
